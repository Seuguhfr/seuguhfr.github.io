<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pairwise Comparison Sort - Fixed</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: system-ui, sans-serif;
    }
    #raw-list li, #sorted-list li {
      transition: background-color 0.3s ease;
    }
    #raw-list li.compared, #sorted-list li.compared {
      background-color: rgba(0, 123, 255, 0.1);
    }
    .modal-body button {
      font-size: 1.1rem;
      white-space: normal;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4 text-center">Pairwise Comparison Sort</h1>

    <!-- Input with form to catch enter -->
    <form id="input-form" class="input-group mb-3" onsubmit="return false;">
      <input id="item-input" type="text" class="form-control" placeholder="Enter an item" autocomplete="off" />
      <button id="add-btn" class="btn btn-primary" type="button">Add</button>
    </form>
    <small class="text-muted">Press Enter or click “Add” to append.</small>

    <!-- Live List Preview -->
    <ul id="raw-list" class="list-group my-4"></ul>

    <!-- Sort Trigger -->
    <button id="start-sort" class="btn btn-success" disabled>Start Sorting</button>

    <!-- Sorted List & Toggle -->
    <div id="result-section" class="mt-5 d-none">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="h5">Sorted List</h2>
        <button id="toggle-order" class="btn btn-outline-secondary btn-sm">Switch to Descending</button>
      </div>
      <ul id="sorted-list" class="list-group"></ul>
    </div>
  </div>

  <!-- Comparison Modal -->
  <div class="modal fade" id="compareModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Which comes first?</h5>
        </div>
        <div class="modal-body text-center">
          <button id="choiceA" class="btn btn-outline-primary mx-2 py-3 w-100"></button>
          <span class="mx-2 align-middle" style="font-size:1.25rem;">vs.</span>
          <button id="choiceB" class="btn btn-outline-primary mx-2 py-3 w-100"></button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (() => {
      const input = document.getElementById('item-input');
      const addBtn = document.getElementById('add-btn');
      const rawListEl = document.getElementById('raw-list');
      const startSortBtn = document.getElementById('start-sort');
      const resultSection = document.getElementById('result-section');
      const sortedListEl = document.getElementById('sorted-list');
      const toggleBtn = document.getElementById('toggle-order');

      // Modal elements
      const compareModalEl = document.getElementById('compareModal');
      const compareModal = new bootstrap.Modal(compareModalEl);
      const choiceA = document.getElementById('choiceA');
      const choiceB = document.getElementById('choiceB');

      let items = [];
      let sorted = [];
      let asc = true;

      // State for sorting
      let currentInsertIndex = 1; // index in items to insert next
      let insertionPosition = 0; // current comparison index in sorted array during insertion
      let insertingItem = null;

      // Render raw list
      function renderRaw() {
        rawListEl.innerHTML = '';
        items.forEach((it) => {
          const li = document.createElement('li');
          li.textContent = it;
          li.className = 'list-group-item';
          rawListEl.appendChild(li);
        });
        startSortBtn.disabled = items.length < 2;
      }

      // Render final sorted list
      function renderSorted() {
        sortedListEl.innerHTML = '';
        const display = asc ? sorted : [...sorted].reverse();
        display.forEach((it) => {
          const li = document.createElement('li');
          li.textContent = it;
          li.className = 'list-group-item';
          sortedListEl.appendChild(li);
        });
        toggleBtn.textContent = asc ? 'Switch to Descending' : 'Switch to Ascending';
      }

      // Start sorting: initialize sorted array with first item
      function startSorting() {
        sorted = [items[0]];
        currentInsertIndex = 1;
        insertionPosition = 0;
        insertingItem = items[currentInsertIndex];
        resultSection.classList.add('d-none');
        startSortBtn.disabled = true;
        addBtn.disabled = true;
        input.disabled = true;
        rawListEl.querySelectorAll('li').forEach(li => li.classList.remove('compared'));
        nextComparison();
      }

      // Show comparison modal for current insertingItem vs sorted[insertionPosition]
      function nextComparison() {
        if (currentInsertIndex >= items.length) {
          // sorting done
          addBtn.disabled = false;
          input.disabled = false;
          startSortBtn.disabled = false;
          renderSorted();
          resultSection.classList.remove('d-none');
          compareModal.hide();
          return;
        }

        if (insertionPosition >= sorted.length) {
          // Insert at end
          sorted.push(insertingItem);
          currentInsertIndex++;
          if (currentInsertIndex < items.length) {
            insertingItem = items[currentInsertIndex];
            insertionPosition = 0;
            nextComparison();
          } else {
            nextComparison();
          }
          return;
        }

        // Show modal for comparing insertingItem and sorted[insertionPosition]
        choiceA.textContent = insertingItem;
        choiceB.textContent = sorted[insertionPosition];

        // Highlight compared items in raw list
        rawListEl.querySelectorAll('li').forEach(li => {
          li.classList.remove('compared');
          if (li.textContent === insertingItem || li.textContent === sorted[insertionPosition]) {
            li.classList.add('compared');
          }
        });

        compareModal.show();
      }

      // Handle user's choice: true if A (insertingItem) should come before B, else false
      function handleChoice(isAfirst) {
        if (isAfirst) {
          // Insert insertingItem here, before sorted[insertionPosition]
          sorted.splice(insertionPosition, 0, insertingItem);
          currentInsertIndex++;
          if (currentInsertIndex < items.length) {
            insertingItem = items[currentInsertIndex];
            insertionPosition = 0;
            nextComparison();
          } else {
            nextComparison();
          }
        } else {
          // Move to next position in sorted to compare
          insertionPosition++;
          nextComparison();
        }
      }

      // Event bindings
      addBtn.onclick = () => {
        const v = input.value.trim();
        if (v) {
          items.push(v);
          input.value = '';
          renderRaw();
        }
      };

      // Allow Enter key to add item
      document.getElementById('input-form').addEventListener('submit', (e) => {
        e.preventDefault();
        addBtn.click();
      });

      startSortBtn.onclick = () => {
        if (items.length < 2) return;
        startSorting();
      };

      toggleBtn.onclick = () => {
        asc = !asc;
        renderSorted();
      };

      choiceA.onclick = () => {
        handleChoice(true);
        compareModal.hide();
      };
      choiceB.onclick = () => {
        handleChoice(false);
        compareModal.hide();
      };

      // Initial render
      renderRaw();
    })();
  </script>
</body>
</html>
